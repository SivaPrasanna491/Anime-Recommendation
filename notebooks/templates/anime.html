<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Anime Recommendations</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap"
      rel="stylesheet"
    />
    <style>
      * { margin: 0; padding: 0; box-sizing: border-box; }

      body {
          min-height: 100vh;
          background: linear-gradient(135deg, #0d0a1f 0%, #1a1033 50%, #2d1b4e 100%);
          color: #e0d4ff;
          font-family: 'Inter', sans-serif;
          padding: 40px 20px;
          position: relative;
          overflow-x: hidden;
      }

      .glow {
          position: fixed;
          width: 800px;
          height: 800px;
          background: radial-gradient(circle, #b14eff 0%, transparent 60%);
          filter: blur(140px);
          opacity: 0.4;
          top: 50%;
          left: 50%;
          transform: translate(-50%, -50%);
          animation: pulse 10s infinite alternate;
          pointer-events: none;
          z-index: 0;
      }

      @keyframes pulse {
          0% { opacity: 0.3; transform: translate(-50%, -50%) scale(1); }
          100% { opacity: 0.5; transform: translate(-50%, -50%) scale(1.1); }
      }

      .container {
          max-width: 1400px;
          margin: 0 auto;
          position: relative;
          z-index: 1;
      }

      .page-header {
          text-align: center;
          margin-bottom: 3rem;
          animation: slideDown 0.8s ease-out;
      }

      @keyframes slideDown {
          from { opacity: 0; transform: translateY(-30px); }
          to { opacity: 1; transform: translateY(0); }
      }

      .page-title {
          font-size: 3rem;
          font-weight: 800;
          background: linear-gradient(135deg, #a78bfa 0%, #ec4899 100%);
          -webkit-background-clip: text;
          -webkit-text-fill-color: transparent;
          background-clip: text;
          margin-bottom: 1rem;
          letter-spacing: -0.02em;
      }

      .page-subtitle {
          font-size: 1.2rem;
          color: rgba(255, 255, 255, 0.7);
      }

      .anime-grid {
          display: grid;
          grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
          gap: 2rem;
          padding: 1rem;
      }

      .anime-card {
          background: rgba(15, 15, 30, 0.6);
          backdrop-filter: blur(20px);
          border: 1px solid rgba(167, 139, 250, 0.2);
          border-radius: 20px;
          overflow: hidden;
          transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
          display: flex;
          flex-direction: column;
          height: 100%;
          position: relative;
          animation: fadeInUp 0.6s ease-out backwards;
      }

      /* Staggered animation for cards */
      {% for i in range(10) %}
      .anime-card:nth-child({{ i + 1 }}) {
          animation-delay: {{ i * 0.1 }}s;
      }
      {% endfor %}

      @keyframes fadeInUp {
          from { opacity: 0; transform: translateY(30px); }
          to { opacity: 1; transform: translateY(0); }
      }

      .anime-card:hover {
          transform: translateY(-10px);
          border-color: rgba(236, 72, 153, 0.5);
          box-shadow: 0 20px 40px rgba(167, 139, 250, 0.3);
          background: rgba(15, 15, 30, 0.8);
      }

      .anime-image-container {
          width: 100%;
          aspect-ratio: 3 / 4;
          overflow: hidden;
          background: linear-gradient(135deg, #1a1033 0%, #2d1b4e 100%);
          position: relative;
          cursor: pointer;
      }

      .anime-image {
          width: 100%;
          height: 100%;
          object-fit: cover;
          transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      }

      .anime-card:hover .anime-image {
          transform: scale(1.05);
      }

      .card-content {
          padding: 1.5rem;
          flex-grow: 1;
          display: flex;
          flex-direction: column;
      }

      .anime-title {
          font-size: 1.4rem;
          font-weight: 700;
          color: #fff;
          margin-bottom: 0.8rem;
          line-height: 1.3;
          background: linear-gradient(90deg, #fff, #e0d4ff);
          -webkit-background-clip: text;
          -webkit-text-fill-color: transparent;
          background-clip: text;
          cursor: pointer;
      }

      .anime-meta {
          display: flex;
          flex-wrap: wrap;
          gap: 0.8rem;
          margin-bottom: 1rem;
      }

      .badge {
          padding: 0.3rem 0.8rem;
          border-radius: 50px;
          font-size: 0.8rem;
          font-weight: 600;
          text-transform: uppercase;
          letter-spacing: 0.05em;
      }

      .badge-type {
          background: rgba(167, 139, 250, 0.2);
          color: #a78bfa;
          border: 1px solid rgba(167, 139, 250, 0.3);
      }

      .badge-rating {
          background: rgba(236, 72, 153, 0.2);
          color: #ec4899;
          border: 1px solid rgba(236, 72, 153, 0.3);
          display: flex;
          align-items: center;
          gap: 4px;
      }

      .badge-episodes {
          background: rgba(59, 130, 246, 0.2);
          color: #60a5fa;
          border: 1px solid rgba(59, 130, 246, 0.3);
      }

      .anime-genres {
          display: flex;
          flex-wrap: wrap;
          gap: 0.5rem;
          margin-bottom: 1rem;
      }

      .genre-tag {
          font-size: 0.8rem;
          color: rgba(255, 255, 255, 0.6);
          background: rgba(255, 255, 255, 0.05);
          padding: 0.2rem 0.6rem;
          border-radius: 4px;
          transition: all 0.2s;
      }

      .anime-card:hover .genre-tag {
          background: rgba(255, 255, 255, 0.1);
          color: rgba(255, 255, 255, 0.9);
      }

      /* Star Rating Styles */
      .rating-section {
          margin-top: auto;
          padding-top: 1rem;
          border-top: 1px solid rgba(167, 139, 250, 0.15);
      }

      .rating-label {
          font-size: 0.85rem;
          color: rgba(255, 255, 255, 0.6);
          margin-bottom: 0.5rem;
          text-transform: uppercase;
          letter-spacing: 1px;
          font-weight: 600;
      }

      .stars-container {
          display: flex;
          gap: 0.3rem;
          align-items: center;
      }

      .star {
          font-size: 1.8rem;
          cursor: pointer;
          transition: all 0.2s ease;
          color: rgba(255, 255, 255, 0.2);
          filter: grayscale(100%);
      }

      .star:hover,
      .star.filled {
          color: #f59e0b;
          filter: grayscale(0%);
          transform: scale(1.15);
      }

      .star:hover ~ .star {
          color: rgba(255, 255, 255, 0.2);
          filter: grayscale(100%);
          transform: scale(1);
      }

      .star:active {
          transform: scale(0.95);
      }

      .back-btn-container {
          text-align: center;
          margin-top: 4rem;
          animation: fadeInUp 0.8s ease-out 0.5s backwards;
      }

      .btn {
          padding: 1rem 3rem;
          font-size: 1.1rem;
          font-weight: 700;
          border: none;
          border-radius: 60px;
          cursor: pointer;
          transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
          font-family: 'Inter', sans-serif;
          text-transform: uppercase;
          letter-spacing: 1px;
          text-decoration: none;
          display: inline-block;
      }

      .btn-primary {
          background: linear-gradient(135deg, #a78bfa 0%, #ec4899 50%, #f59e0b 100%);
          background-size: 200% 200%;
          color: white;
          box-shadow: 0 20px 40px rgba(167, 139, 250, 0.4);
          animation: gradientShift 3s ease infinite;
      }

      @keyframes gradientShift {
          0%, 100% { background-position: 0% 50%; }
          50% { background-position: 100% 50%; }
      }

      .btn-primary:hover {
          transform: translateY(-5px) scale(1.05);
          box-shadow: 0 30px 60px rgba(236, 72, 153, 0.6);
      }

      @media (max-width: 768px) {
          .page-title { font-size: 2rem; }
          .anime-grid { grid-template-columns: 1fr; }
          .star { font-size: 1.5rem; }
      }
    </style>
  </head>
  <body>
    <div class="glow"></div>

    <div class="container">
      <div class="page-header">
        <h1 class="page-title">Recommended Animes</h1>
        <p class="page-subtitle">
          Based on your preferences, we think you'll love these!
        </p>
      </div>

      <div class="anime-grid">
        {% for anime in animes %}
        <div class="anime-card">
          <div
            class="anime-image-container"
            onclick="trackView('{{ anime['englishTitle'] }}', {{ anime['id'] }})"
          >
            <img
              src="{{ anime['imageUrl'] }}"
              alt="{{ anime['englishTitle'] }}"
              class="anime-image"
              loading="lazy"
              onerror="this.src='https://via.placeholder.com/300x450/1a1033/a78bfa?text=No+Image'"
            />
          </div>
          <div class="card-content">
            <h2
              class="anime-title"
              onclick="trackView('{{ anime['englishTitle'] }}', {{ anime['id'] }})"
            >
              {{ anime['englishTitle'] }}
            </h2>

            <div class="anime-meta">
              <span class="badge badge-type">{{ anime['type'] }}</span>
              <span class="badge badge-rating">⭐ {{ anime['rating'] }}</span>
              <span class="badge badge-episodes"
                >{{ anime['episodes'] }} Eps</span
              >
            </div>

            <div class="anime-genres">
              {% for genre in anime['genre'].replace('[', '').replace(']',
              '').replace("'", "").split(',') %}
              <span class="genre-tag">{{ genre.strip() }}</span>
              {% endfor %}
            </div>

            <!-- Star Rating Section -->
            <div class="rating-section">
              <div class="rating-label">Rate this anime</div>
              <div class="stars-container" id="stars-{{ loop.index }}">
                <span
                  class="star"
                  data-rating="1"
                  onclick="rateAnime(event, '{{ anime['englishTitle'] }}', {{ anime['id'] }}, 1, {{ loop.index }})"
                  >⭐</span
                >
                <span
                  class="star"
                  data-rating="2"
                  onclick="rateAnime(event, '{{ anime['englishTitle'] }}', {{ anime['id'] }}, 2, {{ loop.index }})"
                  >⭐</span
                >
                <span
                  class="star"
                  data-rating="3"
                  onclick="rateAnime(event, '{{ anime['englishTitle'] }}', {{ anime['id'] }}, 3, {{ loop.index }})"
                  >⭐</span
                >
                <span
                  class="star"
                  data-rating="4"
                  onclick="rateAnime(event, '{{ anime['englishTitle'] }}', {{ anime['id'] }}, 4, {{ loop.index }})"
                  >⭐</span
                >
                <span
                  class="star"
                  data-rating="5"
                  onclick="rateAnime(event, '{{ anime['englishTitle'] }}', {{ anime['id'] }}, 5, {{ loop.index }})"
                  >⭐</span
                >
              </div>
            </div>
          </div>
        </div>
        {% endfor %}
      </div>

      <div class="back-btn-container">
        <a href="/seenAnimes" class="btn btn-primary" style="margin-right: 1rem;">??? Seen Animes</a>
        <a href="/findanime" class="btn btn-primary">? Search Again</a>
      </div>
    </div>

    <script>
      // Track when user clicks on anime image or title
      function trackView(animeTitle, animeId) {
        fetch(
          `/view?anime_title=${encodeURIComponent(
            animeTitle
          )}&anime_id=${animeId}`
        )
          .then((response) => response.json())
          .then((data) => {
            console.log("View tracked:", animeTitle, animeId);
          })
          .catch((error) => {
            console.error("Error tracking view:", error);
          });
      }

      // Track when user rates anime
      function rateAnime(event, animeTitle, animeId, rating, cardIndex) {
        event.stopPropagation(); // Prevent triggering card click

        // Send rating to backend
        fetch(
          `/rating?anime_title=${encodeURIComponent(
            animeTitle
          )}&anime_id=${animeId}&rating=${rating}`
        )
          .then((response) => response.json())
          .then((data) => {
            console.log("Rating tracked:", animeTitle, animeId, rating);

            // Visual feedback - fill stars up to clicked rating
            const starsContainer = document.getElementById(
              `stars-${cardIndex}`
            );
            const stars = starsContainer.querySelectorAll(".star");

            stars.forEach((star, index) => {
              if (index < rating) {
                star.classList.add("filled");
              } else {
                star.classList.remove("filled");
              }
            });
          })
          .catch((error) => {
            console.error("Error tracking rating:", error);
          });
      }

      // Hover effect for stars
      document.addEventListener("DOMContentLoaded", function () {
        const allStars = document.querySelectorAll(".star");

        allStars.forEach((star) => {
          star.addEventListener("mouseenter", function () {
            const rating = parseInt(this.getAttribute("data-rating"));
            const container = this.parentElement;
            const stars = container.querySelectorAll(".star");

            stars.forEach((s, index) => {
              if (index < rating) {
                s.style.color = "#f59e0b";
                s.style.filter = "grayscale(0%)";
              }
            });
          });

          star.parentElement.addEventListener("mouseleave", function () {
            const stars = this.querySelectorAll(".star");
            stars.forEach((s) => {
              if (!s.classList.contains("filled")) {
                s.style.color = "";
                s.style.filter = "";
              }
            });
          });
        });
      });
    </script>
  </body>
</html>
